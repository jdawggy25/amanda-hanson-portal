---
/**
 * MetricsOverview Component
 *
 * SEO metrics cards and Lighthouse scores display.
 */

import type { ClientMetrics } from '../../lib/metrics';

interface Props {
  metrics: ClientMetrics | null;
}

const { metrics } = Astro.props;

// Helper to format traffic value
function formatTraffic(value: number | null | undefined): string {
  if (value === null || value === undefined) return '-';
  if (value >= 1000) {
    return `${(value / 1000).toFixed(1)}k`;
  }
  return value.toString();
}

// Helper to format currency
function formatCurrency(value: number | null | undefined): string {
  if (value === null || value === undefined) return '-';
  return `$${value.toLocaleString()}`;
}

// Get color for score
function getScoreColor(score: number): string {
  if (score >= 90) return '#10b981';
  if (score >= 50) return '#f59e0b';
  return '#ef4444';
}
---

<div class="metrics-overview">
  {metrics ? (
    <>
      <!-- Core SEO Metrics -->
      <div class="metrics-row">
        <div class="metric-card">
          <div class="metric-value">{metrics.overview.domainRating}</div>
          <div class="metric-label">Domain Rating</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">{formatTraffic(metrics.overview.organicTraffic)}</div>
          <div class="metric-label">Organic Traffic</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">{metrics.overview.organicKeywords}</div>
          <div class="metric-label">Keywords</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">{formatCurrency(metrics.overview.trafficValue)}</div>
          <div class="metric-label">Traffic Value</div>
        </div>
      </div>

      <!-- Lighthouse Scores -->
      <div class="lighthouse-section">
        <h4 class="section-title">Lighthouse Scores</h4>
        <div class="lighthouse-row">
          <div class="lighthouse-score">
            <div
              class="score-circle"
              style={`border-color: ${getScoreColor(metrics.overview.performanceScore)};`}
            >
              <span style={`color: ${getScoreColor(metrics.overview.performanceScore)};`}>
                {metrics.overview.performanceScore}
              </span>
            </div>
            <div class="score-label">Performance</div>
          </div>
          <div class="lighthouse-score">
            <div
              class="score-circle"
              style={`border-color: ${getScoreColor(metrics.overview.seoScore)};`}
            >
              <span style={`color: ${getScoreColor(metrics.overview.seoScore)};`}>
                {metrics.overview.seoScore}
              </span>
            </div>
            <div class="score-label">SEO</div>
          </div>
          <div class="lighthouse-score">
            <div
              class="score-circle"
              style={`border-color: ${getScoreColor(metrics.overview.accessibilityScore)};`}
            >
              <span style={`color: ${getScoreColor(metrics.overview.accessibilityScore)};`}>
                {metrics.overview.accessibilityScore}
              </span>
            </div>
            <div class="score-label">Accessibility</div>
          </div>
          <div class="lighthouse-score">
            <div
              class="score-circle"
              style={`border-color: ${getScoreColor(metrics.overview.bestPracticesScore)};`}
            >
              <span style={`color: ${getScoreColor(metrics.overview.bestPracticesScore)};`}>
                {metrics.overview.bestPracticesScore}
              </span>
            </div>
            <div class="score-label">Best Practices</div>
          </div>
        </div>
      </div>

      <!-- Backlinks Summary -->
      <div class="backlinks-section">
        <h4 class="section-title">Backlink Profile</h4>
        <div class="metrics-row compact">
          <div class="metric-card small">
            <div class="metric-value">{metrics.backlinks.total}</div>
            <div class="metric-label">Total Backlinks</div>
          </div>
          <div class="metric-card small">
            <div class="metric-value">{metrics.backlinks.domains}</div>
            <div class="metric-label">Referring Domains</div>
          </div>
          <div class="metric-card small">
            <div class="metric-value">{metrics.backlinks.dofollow}</div>
            <div class="metric-label">Dofollow</div>
          </div>
        </div>
      </div>

      <!-- Status -->
      <div class="status-section">
        <span class="status-badge">{metrics.overview.status}</span>
        <span class="last-updated">Last updated: {metrics.dataSource.lastUpdated}</span>
      </div>
    </>
  ) : (
    <div class="no-data">
      <p>No metrics data available.</p>
      <p class="hint">Run "Collect Metrics" to fetch data from Ahrefs and Lighthouse.</p>
    </div>
  )}
</div>

<style>
  .metrics-overview {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .metrics-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .metrics-row.compact {
    grid-template-columns: repeat(3, 1fr);
  }

  .metric-card {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 1.25rem;
    text-align: center;
  }

  .metric-card.small {
    padding: 1rem;
  }

  .metric-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.25rem;
  }

  .metric-card.small .metric-value {
    font-size: 1.25rem;
  }

  .metric-label {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .section-title {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 1rem 0;
  }

  .lighthouse-row {
    display: flex;
    gap: 1.5rem;
    justify-content: flex-start;
  }

  .lighthouse-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .score-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 3px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
  }

  .score-circle span {
    font-size: 1.1rem;
    font-weight: 700;
  }

  .score-label {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
  }

  .status-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .status-badge {
    font-size: 0.8rem;
    padding: 0.35rem 0.75rem;
    background: rgba(102, 126, 234, 0.2);
    color: #667eea;
    border-radius: 20px;
  }

  .last-updated {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.4);
  }

  .no-data {
    text-align: center;
    padding: 2rem;
    color: rgba(255, 255, 255, 0.5);
  }

  .no-data p {
    margin: 0 0 0.5rem 0;
  }

  .hint {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.4);
  }

  @media (max-width: 768px) {
    .metrics-row {
      grid-template-columns: repeat(2, 1fr);
    }

    .lighthouse-row {
      flex-wrap: wrap;
      justify-content: center;
    }
  }
</style>
